<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Производительность вёрстки</title>
</head>
<body class="shower">
<header class="caption">
    <h1>Производительность вёрстки</h1>
</header>

<section class="slide white" id="cover">
    <h2 class="shout" style="margin-top: 200px; padding: 30px 0; font-size: 120px; color: #fefffa; font-weight: 600;
        text-shadow: 0 0 60px #3f8bd9; background: rgba(9, 11, 20, 0.5)">Производительность вёрстки</h2>
    <img src="img/cover.jpg" alt="" class='cover h'>
</section>

<section class="slide">
    <h2>Критерии производительности</h2>

    <ul>
        <li class="next">Скорость загрузки</li>
        <li class="next">Отзывчивость интерфейса</li>
    </ul>
</section>

<section class="slide">
    <h2>Критерии производительности</h2>

    <ul>
        <li class="next">Измеримая скорость</li>
        <li class="next">«Ощущение» скорости</li>
    </ul>
</section>

<section class="slide">
    <h2>Скорость загрузки</h2>

    <ul class='double'>
        <li class="next">Размер файлов
            <ul class="next">
                <li class="next">HTML</li>
                <li class="next">CSS</li>
                <li class="next">JavaScript</li>
                <li class="next">JPEG, PNG, SVG</li>
                <li class="next">Шрифты</li>
            </ul>
        </li>
        <li class="next">Скорость соединения</li>
        <li class="next">Скорость отдачи сервером</li>
        <li class="next">Расстояние до сервера</li>
        <li class="next">Количество запросов</li>
    </ul>
</section>

<section class="slide white">
    <h2>«Обычная страница»</h2>

    <img src="img/01-pageSize.png" style="width: 100%" alt="">

    <p>
        <a href="http://httparchive.org/trends.php?s=Top1000&minlabel=Mar+15+2012&maxlabel=Mar+15+2016#bytesTotal&reqTotal">http://httparchive.org/</a>
    </p>
</section>

<section class="slide white">
    <h2>«Обычная страница»</h2>

    <table class="mdl-data-table mdl-js-data-table" data-upgraded=",MaterialDataTable">
        <thead>
        <tr>
            <th></th>
            <th>50-й перцентиль</th>
            <th>75-й перцентиль</th>
            <th>90-й перцентиль</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>HTML</td>
            <td>13 KB</td>
            <td>26 KB</td>
            <td>54 KB</td>
        </tr>
        <tr>
            <td>Images</td>
            <td>528 KB</td>
            <td>1213 KB</td>
            <td>2384 KB</td>
        </tr>
        <tr>
            <td>JavaScript</td>
            <td>207 KB</td>
            <td>385 KB</td>
            <td>587 KB</td>
        </tr>
        <tr>
            <td>CSS</td>
            <td>24 KB</td>
            <td>53 KB</td>
            <td>108 KB</td>
        </tr>
        <tr>
            <td>Other</td>
            <td>282 KB</td>
            <td>308 KB</td>
            <td>353 KB</td>
        </tr>
        <tr>
            <td><strong>Total</strong></td>
            <td><strong>1054 KB</strong></td>
            <td><strong>1985 KB</strong></td>
            <td><strong>3486 KB</strong></td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide white">
    <figure>
        <img class="cover" src="img/network-tab.png" alt="">
    </figure>
</section>

<section class="slide white">
    <img src="img/02-connectionSpeed.png" alt="">
</section>

<section class="slide">
    <p><img src="img/03-devTools.png" alt=""></p>
    <p>
        <a href="https://developers.google.com/web/tools/chrome-devtools/profile/network-performance/resource-loading#view-network-timing-details-for-a-specific-resource">Подробнее
            про Network Tab</a></p>
</section>

<section class="slide">
    <h2>Увеличение скорости загрузки</h2>

    <ul>
        <li class="next">Несколько ресурсов / объединение</li>
        <li class="next">Минификация</li>
        <li class="next">Gzip</li>
        <li class="next">Кеширование</li>
        <li class="next">Географическое распределение</li>
    </ul>

    <p class="next"><a href="http://146.185.165.119/01-downloadTime/">Demo</a></p>
</section>

<section class="slide">
    <h2>Ускорение загрузки ресурсов</h2>

    <ol>
        <li class="next">Текстовые форматы</li>
        <li class="next">Растровая графика</li>
        <li class="next">Шрифты</li>
        <li class="next">Видео и аудио</li>
    </ol>
</section>

<section class='slide'>
    <h2>Текстовые файлы (HTML, CSS, JS, SVG)</h2>

    <ul>
        <li class="next">Минификация и объединение</li>
        <li class="next">Сжатие</li>
        <li class="next">Кеширование</li>
    </ul>
</section>

<section class='slide'>
    <h2>Растровые файлы</h2>

    <ul>
        <li class="next">Правильные алгоритмы сжатия</li>
        <li class="next">Объединение в спрайты / встраивание как data-uri</li>
        <li class="next">Кеширование</li>
    </ul>
</section>

<section class="slide">
    <h2>Data-URI</h2>

    <p>URL-схема, позволяющая включать данные у в строку url, как ссылку на внешний ресурс.</p>

    <pre style='font-size: 80%;' class='next'>
<code>data:[&lt;mime type>][;charset=&lt;charset>][;base64],&lt;encoded data></code>
    </pre>

    <pre class='next'>
<code>li {</code>
<code>  background:</code>
<code>    url(data:image/gif;base64,R0lGODlhEAAQAMQ...);</code>
<code>}</code>
    </pre>

    <p class='next'><a href="https://css-tricks.com/examples/DataURIs/">Demo</a></p>

</section>

<section class="slide">
    <h2>Data-URI</h2>

    <h3 class='next'>Плюсы</h3>

    <ul class='next'>
        <li>Нет лишних запросов</li>
    </ul>

    <h3 class='next'>Минусы</h3>

    <ul>
        <li class='next'>Увеличение объёма (~+30%)</li>
        <li class='next'>Нечитаемо/нередактируемо</li>
        <li class='next'>Сложности с кешированием / инвалидацией</li>
    </ul>

</section>

<section class='slide'>
    <h2>Шрифт</h2>

    <ul>
        <li class="next">Выбор правильного формата</li>
        <li class="next">Оставляем только нужное</li>
        <li class="next">Управление загрузкой</li>
        <li class="next">Кеширование</li>
    </ul>
</section>

<section class="slide">
    <h2>Формат шрифта</h2>

    <pre>
<code><mark>@font-face</mark> {</code>
<code>  font-family: "Open Sans Regular";</code>
<code>  src: url("OpenSans.eot#iefix");</code>
<code class='mark'>  <mark>src</mark>: url("OpenSans.eot") format("embedded-opentype"),</code>
<code class='mark'>       url("OpenSans.woff2") <mark class='important'>format("woff2")</mark>,</code>
<code class='mark'>       url("OpenSans.woff") format("woff"),</code>
<code class='mark'>       url("OpenSans.ttf") format("truetype"),</code>
<code class='mark'>       url("OpenSans.svg#svgFontName'") format("svg");</code>
<code>}</code>
    </pre>
</section>

<section class="slide white">
    <h2>TTF / OTF</h2>

    <p class="ciu_embed" data-feature="ttf" data-periods="future_1,current,past_1,past_2"><a
            href="http://caniuse.com/#feat=ttf">Can I Use ttf?</a> Data on support for the ttf feature across the
        major browsers from caniuse.com. </p>
</section>

<section class="slide white">
    <h2>EOT</h2>

    <p class="ciu_embed" data-feature="eot" data-periods="future_1,current,past_1,past_2"><a
            href="http://caniuse.com/#feat=eot">Can I Use eot?</a> Data on support for the eot feature across the
        major browsers from caniuse.com. </p>
</section>

<section class="slide white">
    <h2>SVG</h2>

    <p class="ciu_embed" data-feature="svg-fonts" data-periods="future_1,current,past_1,past_2"><a
            href="http://caniuse.com/#feat=svg-fonts">Can I Use svg-fonts?</a> Data on support for the svg-fonts feature across the
        major browsers from caniuse.com. </p>
</section>

<section class="slide white">
    <h2>WOFF</h2>

    <p class="ciu_embed" data-feature="woff" data-periods="future_1,current,past_1,past_2"><a
            href="http://caniuse.com/#feat=woff">Can I Use woff?</a> Data on support for the woff feature across the
        major browsers from caniuse.com. </p>
</section>

<section class="slide white">
    <h2>WOFF 2</h2>

    <p class="ciu_embed" data-feature="woff2" data-periods="future_1,current,past_1,past_2"><a
            href="http://caniuse.com/#feat=woff2">Can I Use woff2?</a> Data on support for the woff2 feature across the
        major browsers from caniuse.com. </p>
</section>

<section class="slide">
    <h2>Размер файла шрифта</h2>
    
    <p><a href="http://www.paratype.com/public/">PT SERIF Regular</a></p>

    <table>
        <tr>
            <th>eot</th>
            <td>93 кб</td>
        </tr>
        <tr>
            <th>svg</th>
            <td>362 кб</td>
        </tr>
        <tr>
            <th>ttf</th>
            <td>201 кб</td>
        </tr>
        <tr>
            <th>woff</th>
            <td>107 кб</td>
        </tr>
        <tr>
            <th>woff 2</th>
            <td>77 кб</td>
        </tr>
    </table>
</section>

<section class="slide">
    <h2>Формат шрифта</h2>

    <pre>
<code>@font-face {</code>
<code>  font-family: "Open Sans Regular";</code>
<code class='mark'>  src: url("OpenSans.woff2") format("woff2");</code>
<code>}</code>
<code>body {</code>
<code class='mark'>  font-family: "Open Sans Regular", <mark class='important'>sans-serif;</mark></code>
<code>}</code>
</pre>
</section>

<section class="slide">
    <h2>Управление загрузкой шрифта</h2>

    <ul>
        <li class="next">FOUT / FOIT</li>
        <li class="next">font-display: fallback</li>
        <li class="next">font loading api</li>
        <li class="next">preload / prefetch</li>
    </ul>

</section>

<section class="slide">
    <h2>FOUT / FOIT / FOFT</h2>

    <ul>
        <li class="next"><strong>FOUT</strong> — Flash of Unstyled Text</li>
        <li class="next"><strong>FOIT</strong> — Flash of Invisible Text</li>
        <li class="next"><strong>FOFT</strong> — Flash of Faux Text (<a href="https://www.zachleat.com/web/foft/">En</a>)
        </li>
    </ul>
</section>

<section class="slide black">
    <img src="img/fonts-megafon.PNG" class='cover h' alt="">
</section>

<section class="slide black">
    <img src="img/fonts-pulkovo.PNG" class='cover h' alt="">
</section>

<section class="slide">
    <h2>Асинхронная загрузка шрифта и localStorage</h2>

    <h3 class='next'>Плюсы</h3>

    <ol class='next'>
        <li>Текст доступен для чтения сразу</li>
    </ol>

    <h3 class='next'>Недостатки</h3>

    <ol class='next'>
        <li class='next'>Нужна дополнительная подготовка шрифтов</li>
        <li class='next'>Размер загружаемых файлов больше</li>
        <li class='next'>localStorage не безграничен</li>
    </ol>

    <ul class='next'>
        <li><a href='http://146.185.165.119/03-fonts/'>Demo</a></li>
        <li><a href='https://gist.github.com/h4/36aa17d0337e4ae35536c94f1919e206'>Пример кода</a></li>
    </ul>
</section>

<section class="slide">
    <h2>CSS Font Loading</h2>

    <p class="ciu_embed" data-feature="font-loading" data-periods="future_1,current,past_1,past_2"><a
            href="http://caniuse.com/#feat=font-loading">Can I Use woff2?</a> Data on support for the CSS Font Loading
        feature across the
        major browsers from caniuse.com. </p>
</section>

<section class="slide">
    <h2>CSS Font Loading</h2>

    <ol class='next'>
        <li class='next'>Стандартный интерфейс</li>
        <li class='next'>Нет необходимости в конвертации шрифтов</li>
        <li class='next'><a href='http://146.185.165.119/03-fonts/'>Demo</a></li>
    </ol>

    <pre class="next">
<code>var font = new FontFace("<mark>FiraSans-HeavyItalic</mark>",
  "url(<mark>./FiraSans-HeavyItalic.woff2</mark>)", {});</code>
<code> </code>
<code>font.load().then(() => {</code>
<code class='mark'>  document.body.className = 'font-loaded';</code>
<code>});</code>
    </pre>
</section>

<section class="slide">
    <h2><code>font-display</code></h2>

    <pre>
<code>@font-face {</code>
<code>  font-family: 'Arvo';</code>
<code>  src: local('Arvo'), url(arvo.woff2) format('woff2');</code>
<code class='mark'>  font-display: auto;</code>
<code>}</code>
</pre>


    <h3 class='next'>Значения</h3>

    <ul class="double next">
        <li>auto</li>
        <li>block</li>
        <li>swap</li>
        <li>fallback</li>
        <li>optional</li>
    </ul>

</section>

<section class="slide">
    <h2>CSS Font Loading</h2>

    <p class="ciu_embed" data-feature="css-font-rendering-controls" data-periods="future_1,current,past_1,past_2"><a
            href="http://caniuse.com/#feat=css-font-rendering-controls">Can I Use woff2?</a> Data on support for the
        css-font-rendering-controls
        feature across the
        major browsers from caniuse.com. </p>

    <p class='next'><a href='http://146.185.165.119/03-fonts/'>Demo</a></p>
</section>

<section class="slide">
    <h2>Инструменты контроля скорости загрузки</h2>

    <ul>
        <li class="next">DevTools</li>
        <li class="next"><a href="http://www.webpagetest.org/">webpagetest.org</a></li>
        <li class="next"><a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed Insights</a></li>
    </ul>
</section>

<section class="slide">
    <h2>DevTools</h2>

    <ul>
        <li class="next">Network tab</li>
        <li class="next">Timeline tab</li>
        <li class="next">Audits</li>
    </ul>
</section>

<section class="slide">
    <h2>PageSpeed Insights</h2>

    <ul>
        <li class="next">Desktop</li>
        <li class="next">Mobile</li>
    </ul>
</section>

<section class="slide white">
    <h2 style='font-size: 72px; letter-spacing: 2px; color: #FFF;'>Отзывчивость интерфейса</h2>
    <img src="img/smoothest.jpg" class='cover h' alt="">
</section>

<section class="slide white">
    <img src="img/progressive-rendering.png" class='cover' alt="">
</section>

<section class="slide">
    <h2>Что происходит после загрузки?</h2>

    <ul>
        <li class="next">Парсинг HTML</li>
        <li class="next">Построение DOM</li>
        <li class="next">Построение SCCOM</li>
        <li class="next">Построение результирующего дерева</li>
        <li class="next">Вычисление геометрии блоков</li>
        <li class="next">Отрисовка пикселей на экране</li>
    </ul>
</section>

<section class="slide">
    <h2>Построение DOM. Блокирующие и неблокирующие ресурсы</h2>

    <ul>
        <li class="next">События загрузки страницы DOMContentLoaded и loaded</li>
        <li class="next">Блокирующий и неблокирующий CSS</li>
        <li class="next">Блокирующий и неблокирующий JavaScript</li>
    </ul>
</section>

<section class="slide">
    <h2>Оптимизация Critical Path</h2>

    <ul>
        <li class="next">Минимизация количества критических ресурсов</li>
        <li class="next">Минимизация объема критических ресурсов</li>
        <li class="next">Как можно скорее загружаем критические ресурсы</li>
    </ul>

    <p><a href="http://146.185.165.119/04-critical-rendering-path">Demo</a></p>
</section>

<section class="slide">
    <h2>Построение CSSOM и результирующего дерева</h2>

    <ul>
        <li class="next">Уменьшение вложенности селекторов</li>
        <li class="next">Использование простых селекторов</li>
    </ul>
</section>

<section class="slide">
    <h2>Отрисовка пикселей</h2>

    <p><img src="img/05-pixelPipeline.jpg" style="width: 100%" alt=""></p>
</section>

<section class="slide">
    <h2>Repaint, Reflow, Compositing</h2>

    <p>Пользователь взаимодействует со страницей, страница реагирует &mdash; меняет DOM-дерево или применяемые стили</p>

    <ul>
        <li class="next">Reflow (Layout) &mdash; изменяется геометрия элемента</li>
        <li class="next">Repaint &mdash; изменяется только цвет пикселей</li>
        <li class="next">Compositing &mdash; изменение порядка смешивания цветов пиксела</li>
    </ul>
</section>

<section class="slide">
    <h2>Что вызывает Reflow?</h2>

    <ul>
        <li class="next">Изменение геометрии блока</li>
        <li class="next">Изменение свойств шрифта</li>
        <li class="next">Больше на <a href="https://csstriggers.com/">csstriggers.com</a></li>
    </ul>
</section>

<section class="slide">
    <h2>Оптимизация Reflow</h2>

    <ul>
        <li class="next">Подбор свойств, которые не вызывают Reflow</li>
        <li class="next">Вынесение блока из потока</li>
    </ul>
</section>

<section class="slide">
    <h2>CSS-Анимации</h2>

    <ul>
        <li class="next">Избегайте триггеров Reflow</li>
        <li class="next">translate()</li>
        <li class="next">scale()</li>
        <li class="next">opacity</li>
        <li class="next">will-change: transform</li>
        <li class="next">translateZ() / translate3D()</li>
    </ul>

    <p class="next"><a href="http://146.185.165.119/02-repaint-reflow/">Demo</a></p>
</section>

<section class="slide">
    <h2>Измерение Repaint/Reflow</h2>

    <ul>
        <li class="next">Вкладка Timeline</li>
        <li class="next">Settings > Show FPS Meter</li>
    </ul>
</section>

<section class="slide">
    <h2>Особенности мобильных</h2>

    <ul>
        <li class="next">Более нестабильное соединение</li>
        <li class="next">Более слабое железо</li>
        <li class="next">Меньше объём кеша/localStorage</li>
        <li class="next">Аппаратное ускорение &mdash; палка о двух концах</li>
    </ul>
</section>

<script src="build/main.js"></script>
<script src="//cdn.jsdelivr.net/caniuse-embed/1.0.1/caniuse-embed.min.js"></script>
</body>
</html>
